var $=jQuery.noConflict();$(document).ready(function(e){"use strict";e("#cfm-captivate-shows-modal").on("show.bs.modal",function(s){e(document).loadCaptivateShows()}),e("#cfm-captivate-shows-modal").on("hidden.bs.modal",function(s){e("#cfm-captivate-shows").html("")}),e(document).on("click","#cfm-select-captivate-shows",function(s){s.preventDefault();var t=e(this);let a=[],o={};e.each(e("input[name='shows_to_sync']:checked"),function(){a.push(e(this).val())}),e.each(e("#cfm-captivate-shows ul select"),function(){let s=e(this).attr("name"),t=e(this).val();o[s]=t}),e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"select-captivate-shows",shows:a,authors:o,_nonce:cfmsync.ajaxnonce},beforeSend:function(){e("#cfm-captivate-shows > li input").prop("disabled",!0),t.prop("disabled",!0),t.html('<i class="fas fa-spinner fa-spin me-2"></i> Syncing podcasts and episodes...')},success:function(s){var a=JSON.parse(s);if(a.return){for(var o=a.return.length,n=0;n<a.return.length;++n)0==a.return[n].success?e("li#show-"+a.return[n].id+" label").append('<span class="text-danger">('+a.return[n].error+")</span>"):o-=1;0==o?(cfmsync_toaster("success","Podcasts and episodes synced successfully."),setTimeout(function(){location.reload(!0)},2e3)):(cfmsync_toaster("error","It looks like we've ran into a few issues whilst selecting these podcasts to sync."),setTimeout(function(){location.reload(!0)},5e3))}else cfmsync_toaster("success","Podcasts already selected successfully."),setTimeout(function(){location.reload(!0)},2e3);t.html('Select &amp; Sync Podcasts <i class="fal fa-sync ms-2"></i>')}}),s.preventDefault()}),e(document).on("click","#cfm-manual-sync-data",function(s){s.preventDefault();var t=e(this),a=t.html();e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"sync-shows",_nonce:cfmsync.ajaxnonce},beforeSend:function(){t.prop("disabled",!0),t.siblings("button").prop("disabled",!0),t.html('<i class="fas fa-spinner fa-spin me-2"></i> Syncing podcasts and episodes...')},success:function(s){"success"==s?cfmsync_toaster("success","Sync complete!"):cfmsync_toaster("error",s),t.prop("disabled",!1),t.siblings("button").prop("disabled",!1),t.html(a),e(document).loadWPShows(e("input[name=data_content]").val(),"",e("#cfm-dropdown-sort-podcasts").data("sort")),e("#confirmation-modal").modal("hide")}}),s.preventDefault()}),e(document).on("change","select[name=page_for_show]",function(s){s.preventDefault();var t=e(this),a=t.closest(".cfm-show-wrap").prop("id").split("_")[1],o=t.val();e(document).disableFields("input[name=display_episodes]"),e(document).disableFields("select[name=display_episodes]"),e(document).disableFields("select[name=page_for_show]"),e(document).disableFields("select[name=author_for_show]"),e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"set-show-page",_nonce:cfmsync.ajaxnonce,show_id:a,page_id:o},success:function(s){"success"==s?cfmsync_toaster("success","Podcast episodes individual URL will now use the slug of the selected page."):"already_exists"==s?(t.val("0"),cfmsync_toaster("error","The selected page is already mapped to one of your podcasts. Please select a different page.")):cfmsync_toaster("error",s),setTimeout(function(){e(document).enableFields("input[name=display_episodes]"),e(document).enableFields("select[name=display_episodes]"),e(document).enableFields("select[name=page_for_show]"),e(document).enableFields("select[name=author_for_show]")},5e3)}}),s.preventDefault()}),e(document).on("change","select[name=author_for_show]",function(s){s.preventDefault();var t=e(this).closest(".cfm-show-wrap").prop("id").split("_")[1],a=e(this).val();e(document).disableFields("input[name=display_episodes]"),e(document).disableFields("select[name=display_episodes]"),e(document).disableFields("select[name=page_for_show]"),e(document).disableFields("select[name=author_for_show]"),e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"set-show-author",_nonce:cfmsync.ajaxnonce,show_id:t,author_id:a},success:function(s){"success"==s?cfmsync_toaster("success","Podcast author has been set successfully."):cfmsync_toaster("error",s),setTimeout(function(){e(document).enableFields("input[name=display_episodes]"),e(document).enableFields("select[name=display_episodes]"),e(document).enableFields("select[name=page_for_show]"),e(document).enableFields("select[name=author_for_show]")},5e3)}}),s.preventDefault()}),e(document).on("change","input[name=display_episodes], select[name=display_episodes]",function(s){s.preventDefault();var t=e(this),a=t.closest(".cfm-show-wrap").prop("id").split("_")[1],o=this.checked?"1":"0";t.is("select")&&(o=t.val()),e(document).disableFields("input[name=display_episodes]"),e(document).disableFields("select[name=display_episodes]"),e(document).disableFields("select[name=page_for_show]"),e(document).disableFields("select[name=author_for_show]"),e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"set-display-episodes",_nonce:cfmsync.ajaxnonce,show_id:a,display_episodes:o},success:function(s){"success"==s?"0"==o?cfmsync_toaster("success","Podcast episodes will now appear on the selected page."):cfmsync_toaster("success","Podcast episodes will not appear on the selected page."):cfmsync_toaster("error",s),setTimeout(function(){e(document).enableFields("input[name=display_episodes]"),e(document).enableFields("select[name=display_episodes]"),e(document).enableFields("select[name=page_for_show]"),e(document).enableFields("select[name=author_for_show]")},5e3)}}),s.preventDefault()}),e(document).on("click","#cfm-sync-show-and-episodes",function(s){s.preventDefault();var t=e(this),a=t.html(),o=t.attr("data-reference");e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"sync-show",show_id:o,_nonce:cfmsync.ajaxnonce},beforeSend:function(){t.prop("disabled",!0),t.siblings("button").prop("disabled",!0),t.html('<i class="fas fa-spinner fa-spin me-2"></i> Syncing podcast and episodes...')},success:function(s){"success"==s?cfmsync_toaster("success","Sync complete!"):cfmsync_toaster("error",s),t.prop("disabled",!1),t.siblings("button").prop("disabled",!1),t.html(a),e(document).loadWPShows(e("input[name=data_content]").val(),"",e("#cfm-dropdown-sort-podcasts").data("sort")),e("#confirmation-modal").modal("hide")}}),s.preventDefault()}),e(document).on("click","#cfm-clear-publish-data",function(s){s.preventDefault();var t=e(this).attr("data-reference"),a=t+"_cfm-form-publish-episode_save_storage";localStorage.removeItem(a),localStorage.removeItem(t+"_featured_image_url_local"),localStorage.removeItem(t+"_post_content_wp_local"),localStorage.removeItem(t+"_shownotes_local"),localStorage.removeItem(t+"_shownotes_local_html"),cfmsync_toaster("success","Publish episode auto-saved data cleared successfully."),e("#confirmation-modal").modal("hide"),s.preventDefault()}),e.fn.disableFields=function(s){""!=s&&e(s).each(function(){e(this).prop("disabled",!0)})},e.fn.enableFields=function(s){""!=s&&e(s).each(function(){e(this).prop("disabled",!1)})},e.fn.loadCaptivateShows=function(){e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"manage-captivate-shows",_nonce:cfmsync.ajaxnonce},beforeSend:function(){e("#cfm-captivate-shows").html(cfm_content_spinner)},success:function(s){e("#cfm-captivate-shows").html(s)}})},e("#cfm-grid-view").on("click",function(s){e(this).addClass("disabled"),e("input[name=data_content]").val("grid"),e(document).loadWPShows("grid",e(this),"content_view")}),e("#cfm-list-view").on("click",function(s){e(this).addClass("disabled"),e("input[name=data_content]").val("list"),e(document).loadWPShows("list",e(this),"content_view")}),e("#cfm-dropdown-sort-podcasts .dropdown-item").on("click",function(s){e("#cfm-dropdown-sort-podcasts").attr("data-sort",e(this).data("sort")),e(document).loadWPShows(e("input[name=data_content]").val(),e(this),e(this).data("sort"))}),e(document).on("click",".cfm-shows-list .toggle-row",function(s){var t=e(this).data("show-id"),a=e(this).find("i");e("#row_detail_"+t).toggle(),e('.datatable-row-detail[data-show-id="'+t+'"]').toggle(),a.hasClass("fa-chevron-right")?a.removeClass("fa-chevron-right").addClass("fa-chevron-down"):a.removeClass("fa-chevron-down").addClass("fa-chevron-right")}),e.fn.loadWPShows=function(s,t="",a){"grid"==(s="list"==s?"list":"grid")&&(e("#cfm-grid-view").addClass("active"),e("#cfm-list-view").removeClass("active")),"list"==s&&(e("#cfm-list-view").addClass("active"),e("#cfm-grid-view").removeClass("active")),""!=t&&"content_view"!=a&&(e("#cfm-dropdown-sort-podcasts .dropdown-item").removeClass("active"),t.addClass("active")),e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"load-shows",_nonce:cfmsync.ajaxnonce,layout:s,this_action:a},beforeSend:function(){e("#cfm-shows").html(cfm_content_spinner)},success:function(s){e("#cfm-shows").addClass("cfm-shows-grid").removeClass("cfm-shows-list"),e("#cfm-shows").html(s)},complete:function(){""!=t&&t.removeClass("disabled")}})},e(document).loadWPShows(e("input[name=data_content]").val(),"",e("#cfm-dropdown-sort-podcasts").data("sort"))});